# Python program to convert text
# file to JSON  
import json
  
  
# the file to be converted
filename = 'puggleboot-initramfs-image-ogpuma-20210412035352.rootfs.cve'
  
cveList = []
  
# fields in the sample file 
fields =['packageName', 'packageVersion', 'cveId', 'cveStatus', 'cveSummary', 'cvssv2', 'cvssv3', 'nistLink']

currentCve = {}
cvePatched = True
  
with open(filename) as fh:
    for line in fh:          
        # reading line by line from the text file
        data = line.strip().split(":")
        
        field = data[0]
        if len(data) > 1:
            value = data[1].strip()


        if field == "PACKAGE NAME":
            currentCve["packageName"] = value
        elif field == "PACKAGE VERSION":
            currentCve["packageVersion"] = value
        elif field == "CVE":
            currentCve["cveId"] = value
        elif field == "CVE STATUS":
            if "Unpatched" in value:
                cvePatched = False
        elif field == "CVE SUMMARY":
            currentCve["cveSummary"] = value
        elif field == "CVSS v2 BASE SCORE":
            currentCve["cvssv2"] = value
        elif field == "CVSS v3 BASE SCORE":
            currentCve["cvssv3"] = value
        elif field == "MORE INFORMATION":
            currentCve["nistLink"] = value
            if not cvePatched:
                cveList.append(currentCve)
            currentCve = {}
            cvePatched = True
  
  
# creating json file        
print(len(cveList))
out_file = open("src/data.js", "w")
out_file.write('export const cveData = ')
json.dump(cveList, out_file, indent = 4)
out_file.write(';')
out_file.close()