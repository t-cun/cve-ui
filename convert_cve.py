# Python program to convert text
# file to JSON  
import json
import urllib.request

cveList = []
currentCve = {}
cvePatched = True
cveCount = 1

target_url = "http://willikins.bne.opengear.com/view/ngcs/job/ngcs/lastSuccessfulBuild/artifact/ngcs/build/tmp-glibc/deploy/images/ogpuma/og-image-consoleserver-ogpuma.cve"
data = urllib.request.urlopen(target_url)

# Comment out the two lines above and uncomment the two lines below to test with a local file
#testFile = 'exampleReport.cve'
#data = open(testFile)
  
for line in data:
    # reading line by line from the text file
    data = line.strip()
    data = data.decode("utf8").split(":", 1)

    field = data[0]
    if len(data) > 1:
        value = data[1].strip()


    if field == "PACKAGE NAME":
        currentCve["packageName"] = value
    elif field == "PACKAGE VERSION":
        currentCve["packageVersion"] = value
    elif field == "CVE":
        currentCve["cveId"] = value
    elif field == "CVE STATUS":
        if "Unpatched" in value:
            cvePatched = False
    elif field == "CVE SUMMARY":
        currentCve["cveSummary"] = value
    elif field == "CVSS v2 BASE SCORE":
        currentCve["cvssv2"] = value
    elif field == "CVSS v3 BASE SCORE":
        currentCve["cvssv3"] = value
    elif field == "MORE INFORMATION":
        currentCve["nistLink"] = value
        if not cvePatched:
            currentCve["cveNumber"] = cveCount
            cveCount = cveCount + 1
            cveList.append(currentCve)
        currentCve = {}
        cvePatched = True
  
  
# creating json file        
print(len(cveList))
out_file = open("src/data.js", "w")
out_file.write('export const cveData = ')
json.dump(cveList, out_file, indent = 4)
out_file.write(';')
out_file.close()